# GC处理器

```plain
-XX:+UseSerialGC
 单核STW eden标记复制 old 标记整理


-XX:+UseParallelGC  
多核STW  只提升回收速率


-XX:+UseConcMarkSweepGC 
初始标记 并发标记 重新标记 并发清除减少一定STW时间，产生内存碎片9已废弃


-XX:+UseG1GC
分块2048region动态分区控制STW时间  -XX:MaxGCPauseMillis


-XX:+UseZGC 
 超短停顿10ms，基本流程转移，相比G1主要体现在并发转移，jdk21完成分代算法


-XX:+UseShenandoahGC ZGC同款收集器，发展没ZGC好
宗旨: 尽量控制mutator暂定时间没来达到更少的停顿感，同时尽量保证高吞吐。


```



# G1GC

```plain
G1GC 核心配置：-XX:UseG1GC -XX:MaxGCPauseMills=50ms
```
说明：G1GC将整个Java堆分成多个大小相等的region,默认2048个，根据内存空间大小确定大小,region动态分代 young old humongous
## 

## Young GC

```plain
region满触发
标记复杂算法相比其他GC增加了跨region引用的Rset记录


初始标记（STW）：标记GC Roots直接关联的对象（与Young GC同步完成）。
复制存活对象（STW）：将Eden区和Survivor区的存活对象复制到新的Survivor区或晋升到老年代Region。
更新引用：通过写屏障记录跨Region引用，维护Remembered Set加速后续回收。
```


## Mixed GC

并发标记完成后根据-XX:MaxGCPauseMills逐步选择Region回收

### 并发标记：默认堆占用45%触发-XX:InitiatingHeapOccupancyPercent


1.初始标记 STW

```plain
短暂的暂停muator,根扫描标记可达对象.
---使用写屏障可以感知对象修改，部分根非对象，使用读屏障太慢，综合考虑使用暂停扫描
```
2.根区域扫描 Survivor 作为root region的引用
3.并发标记

```plain
SATB 技术,一个线程本地STAB队列集合和一个全局STAB队列集合，本地装对象不会发生线程资源
竞争，装满后会放入全局。
---对象引用关系变化不会改变存活对象触达链路的总条数，扫描SATB代价低
```
4.最终标记 STW
```plain
SATB处理剩余引用变更
未装满的本地队列不会添加到STAB队列，本地队列数据会被muator操作，需要暂停，这时所有未标记的对象就是死亡对象
```
5.清理 STW
```plain
统计各Region的垃圾比例，选择高收益Region加入混合回收候选集


对象计数
扫描标记位图，pre-mark存放上次标记结束存活对象的字节数，初始值为0，计数过程暂停转移
记忆集合线程（remembered set），转移可能在计数中启动需要等待计数完
转移后next-mark也会变为0
标记位图是一个二进制位数组，它的每个位代表了堆中的一个内存块。如果该位的值为1，则表示该内存块中存在一个存活的对象；如果该位的值为0，则表示该内存块中不存在存活的对象。


标记预清理
有些数据会和muator共享需要暂停。
以区域为单位进行回收，计算每个区域的转移效率，进行降序排序，标记位图的pre和next重置。
--死亡对象的字节数/转移时间


标记位图prev得到存活对象和死亡对象的区分， prev-mark得到存活对象字节数。
这些信息交给转移处理
```
### 转移

```plain
region区域所有存活对象被转移到空闲region,被转移的区域只有死亡对象重置变为空闲region
```


转移记忆线程：

1个region有个remember set记录region和卡表的索引,卡表是二进制数组表示堆对象的偏移量。region 512b=卡表1b


1.选择回收集合

```plain
  根据标记后的区域排序和转移效率进行回收，会结合用户设置的MaxGCPauseMills
```
2.根转移
```plain
  根直接引用的对象、并发标记处理的对象、rem set集合对象
 
  1.对象转移到新的region，原对象地址记录新地址指针
  2.对象引用的所有位于rem set的对象，添加进转移队列
  3.对象引用位于rem set外的对象，更新专用记忆集合
  4.对象被引用的，更新专用记忆集合 
```
3.转移
```plain
跟转移完成后，完成转移队列的转移，清空rem set
```


## **Full GC**

```plain
Mixed GC 无法回收出有用空间，蜕化为SerialGC 全堆压缩回收
```



# ZGC

页管理和指针染色和读屏障尽可能短的完成回收任务,访问对象头即可获取GC信息可存大小2^44


指针染色

![图片](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAADJCAYAAAD8WIB+AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAHdElNRQfpAR4JAAEI7+LvAAAAAW9yTlQBz6J3mgAAKKFJREFUeNrt3X18FOW99/FPqqcmKK3cQQlFHhRLorSERqSWhCrUEirW4xFL0RD6eAgFlReCeKqGpoEbb1GkaEFCq+3hQZGecJRWbuJ9FxETioiRYNGEVojgQ7SJQWlJbLF7/rj22szO7uY5O7ub7/v1mleS2dmZ3+zuZH77u665BkREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREpFtkAz7/T+ffhV4HJgmrENgBpDr+dn4GOyvVv948x7w817bCSQHWAgeA9Da24VxfuHXnufYlL8J67XGWh4h0B53LRKLMnnTdB5k9qbd1knMnA/Zk3NZJWyQcdwLmFu7zmo5J0rp6okj1T2tp+Qz7XFO4bRSGWc5H+MTRnYC6n7MWcwwNduyr83F7LCoBFQlVSPjjrj3/I3QuE4kie1C6T6yFtJwII1VgoOUEOcu/vC/CZNcl0hpnwhUpAc3GfB7/lZbPbripM4lZIeG/iK2lJTF1Pm5PUO7thaucOJe1yelyQk9udrk8Wj/2lICKBLPnswOEHjP2S2KkBFTnMpEociafzgMzXDNkJDoJSndyVhKzW1nmAG03dXdUCuaz70xC7TGSR0tiWOiPbQdwL5FPVJGqps4KqPsYdCfQ7sqq8+SnY0+khfML3gGC/z/YY6W1BFTHk3Tap7wOIE79J5ABVDnm9QfSgItoPRlIAfIdf2eHWbat5lQRKxuYChS0sky6fxmrO5vMmoAGYI0/llnAfKAU2ORadhhQCxQDi4EyzHHTByjxT33888pa2WYNMBpICjNtAn6LaYov829nNrAQc0yV+9exEVVmRG7AHJe3u+bbL5W3E/lY1LlMukQJaMfVACtbeXwQ5iQ6A1hNaMUpi+BkoRpzgE/0/50CjPfPq/Z6ZyWm2RNAKXColeWmAZmOv3cCuZgvUQBDgCuACkwy2VGFmMQvD/gb5vNdjEnuAF7w/73R/3tTF/fbWZlxT7argXsbSzAJao7/7xn+v2d3Qzwi8SgV8/9jA/C+67HJ/p/PtPJ8ncukS5SAdj97gq3FnPTHhFnmflqqpw2YE3825h9CH8w30s4mA9J72OrFmjaW+yvmM2e5TxT9MZ/VnZ2MYwnmhNWASURtRdPaRHCF0soF6oFTmBNZgf/3ev9jbrnA74GRmOMnw7HeHMdyhY51FKMmQpFw5mDOU1td89OBOzDHdVvnIJ3LRDzgvjrQ3QfU2Q/O6QLg667HnE0X6lMj7eG+OMddBXQajWkaP0BLRd7ZDN/V/qGRrmZvrV+nuxtAe/bTLt9WBRQij1Kh40sk/EgRth/oQtrukw06l0kXqQLafey3v3zMwW0rn/tdy70FHHPNc1akJmK+Ue5HJLImTPOxuwKYg/kcOh3ANI072Wb4HMyJYi+hn8v2ss3b7kqkleN4fEk712kTz4X+/Zzhery1CqhbIToJijg1YFot7PEzA3NMfRt4wDHf9sdeTOixq3OZdIkS0O71AKZJox7T320ups9oW+w/gwcwfUi7kgyItEcF5gRTjbl4zt03M1IFMRLn8oNpuahoMOEHvD/i327/COuzzXdHIjye6Y/dVmfKIyxX7P+5CRHpaTqXicQ42zw/n/DNIK0NyC3SGXZszFm03kRurwoPd0VrJO4mfFu9dF5hHqnLSmuxuAeed8bm3B5h4k3HVGJ0JySRnqNzmYiIdKs8NESRiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIRMfPgINeByESZUeAe7wOQkS6jY5p6Raf8jqAXqSPfxLpTVL8k4gkBh3T0i2UgIqIiIiIJKjXgUavgxCJskagwusgRKTb6JiWbqEKaPTUAJ94HYRIlDUB73sdhIh0Gx3T0i2UgEbPb4GzgW94HYhIFB0BxqH+zyKJQse0dAsloNHzZWAPJhH9odfBiETBWcAATHPdTsxJS0Til45p6TZneB1AgjoHGAFMAGYDvwBOAHOBrf55y4DhwGeAJOBj/yQSr84DRgHfBO4E1gPrgALMl93lwM3ABZjqyT8xzXmnvQ5cRMLSMS09JinMvE8B1wI5wBeBYcD5QF/gX7wOOIZ9gkkg/4rppF0HvAm8BryE+bbodBkwEcgCPg98DjgXSAZqgQu93qEY9AnwN6AeOI55bV8EdgDvRXjOGMzr/CVCX+djwFCvdypOvQKMxpxomoGPgAbgHUwT3auYir977NtrgPGY/y0XYqopfYFPe71DCUDHh3SFjmnpDp35PwTAbZikaTdwNzAJk4Ce5fUexbjzgf7AZ+naa3Umpp+oRPYpIA3IBm7BVJT/Dqwg+LUfD5RhPs8PA9OBL2DeI+ke5wGpmJPNmV1Yz1mYVgPpOh0f0hU6pqU7tPf/UMAa4DlMRU4knqQCJcALmG/d/4b5sP/A68BEYoCODxHxmvv/UMAUTHldJJ79AtM5vh7I9ToYkRij40NEvGb/DwU8DfyH11GJdFEapkmx0utARGKQjg8R8VoasAvoa4dh+gym07FIPKvDXCj3odeBiMSgOkzTl44PEfFKHeADTjrHAT3gdVQi3WAgcNTrIERiVBo6PkTEW1eBBqIXERERkShTAioiIiIiUaUEVERERESiKumWB5/z7Sv7NYOGj2bQxaO9jkekS15+4GaGn/tZZlya4XUoIjFn0SvHGXz+MKaMm+p1KCLSSz2zp5Rn/lCadCbAxv981Ot4RLrFkT1f5qq77vE6jC7btWyp9iOGJMp+zN50mCnfn+B1GCLSyz3zh1I1wYuIiIhIdCkBFREREZGoUgIqIiIiIlGlBFREREREokoJqIiIiIhElRJQEREREYkqJaAiIiIiElVKQEVEREQkqpSAioiIiEhUKQEVERERkahSAioiIiIiUaUEVERERESiSgmoiIiIiESVElARERERiSoloCIiIiISVUpARURERCSqlICKiIiISFQlZALa3NzE4kVzWLxoDs3NTWGXOdHYwA9uuobVDy4NzKvct4cRaWdSuW9P2PWNSDuz1em6r2Vx9I2aTse9rfRxfnDTNZxobODoGzWsfnBpyHZtvNtKH28znm2lj3v9VoiISBc1nmhk5qybyP/36Uy+4WqGjhwYMs2cdRONJxqDnvfQ2pVMvuFqjhx9I+K6H1q7MmRdT/1ua+Dx5uZm7vrpIu766SKam5tD5g8dOZD9r7zUrvgfWrsyZLttPffI0TeYfMPVIduX+Hem1wF4pfGDev7yfh1/qnmNEWnBL8P0674a+H3eoiJ+MGeBmT9zFncVryA5OYXVDy6l8qU9rFizgXP7pbKt9HF+ueaBTsVSuW9P0DbHXjIg6PF5i4rI+96PWDAnn8FDLwrMzxg5ilXrnuDC4elByx99o4Z5s26KuL0TjQ0smJPPC889G3EdEt4HH37Id+66h6+MzuSuf/+h1+FoP7Qf0gs0Nn7A+/V/4cbrp7G7/DmumbSI22bPDzz+0NqV7K/cx8cfm6Rw05YNQc+fcG1O2PXmTctn8Z3FgXXtf+Ulps64jmNvvcnQkQPDPmfxncUAFN+3OLCdqTOuC1qmdOM2xnzp8sDfbxz9M89X7GJM1tiQ9Tqfa+NZ9+tHWPHw8qDlXq85FLRfC24Nfg0k/iREAupMqNw2r18X+H38hEmBhPHVAy9z3vlpFP2fh/lZiakU2kRw87bdZI0dF3hepCpqd8kaO47DdafZVvo4T//XRnKumsR/b1nPfat+xRPrSwA48qca/vJ+HV8cfVngedWHDpKbPbLD29v0q0cYNHgYB2tP8uiaFSy9Z37gdZHIDte+yYz/+DEHDx/mK6MzvQ5H+6H9kF7id2XbOL//eUz86tXsLn8u4nJnnZXMsp8sZ9lPlvPQ2pVsf/YZ1qwo4aILh0d8zpGjb7B56+PcPvcOAC5JH8m1udcFkrvm5maK71sMmOTznXffZs6CAl6vORSUaB45+gZzFhSQlZnFFy75YtA29rxYzpXZV5E//bvtThptMpqcnBw03xmPxLeESEDP7ZfKo09sD/zd3NzEssWmamkrlk7NzU3sf7GcQYOH8e7bbzHzxq9Tfehg4HFbjbTVwYGDhgAmmXUmtBBcrcwYOarDsdtYneu1ifS6n5tvgOec8xme+q+N5E65IahS2ZkK6InGBipf2kPW5eNITk7hKzkTWbW8iCN/qglKuiWYM0mIZ9qP2JIo+yE9p/FEI/sr93HBoMGkpJhz2YqHl4dUCK/Mvirw+5Gjb7D92We4ZtKUVpNPgIOHqih5bA2Xpptixvn9z+ODEx+weUVLUur0u7JtvF5zCAitfEJLpfKS9JGsWWEKKNuffYaszCyaP25m5qybeL5iV8jz7PI23k1bNoRUcp0W3LrI67dGuigh+4C25bWDr4Qkkpu37Wbztt0hvztNnzmLg7UnOVx3mnmLihg/YRL7Xn+Pw3WneWD1+k7FkpycQvHyNRysPcn0mbPIGDmKsopDHK47zb0/+yV9P/PZwLKVL+3hRGND4G9bAXX3/czNHhmUUDvZrge2Kb9faioZI0fx1vFar9+WmDfjm9dycGspo0aM8DoU7Yf2Q3qJ58ufCyRs/T7bj/XrnuDNQ+9SunEbYJq73zz0LuvXPUG/c/sBLUniuC/nhO3jaaf9r7zE9dfewIJbF7H2sTWUPr2FCwYN5vCfayh5bA1/fP3VkHjyp3+XK7OvYtV9q3nz0LvUvHyUvGn5XJl9FQcqXguKDUyCaxNWZ/zuacfW/x+ULOdNy6fm5aMhy9ntSfxLiAro6geXsmp5UdjH3InmvEVFba/QJTk5hQFpn+O9und6JH5bsbRJo21WX3L/IwCcfc45fCvve8ybdRO7d5Zx3dSbA5NEx4hhQxkxbCiHa9/0OhTth/ZDepFjb7V8Nh5cfT8lj60JetxZhVxw6yKGXDA0qDp62+z5Ic3plVWVQdXGa3OvY/uzz7B7z/Osum81k6++hj++dpCt237D8AsvDhvXvDvnMu/OuUHzRmdfGvj9kvSRfPz3j9n38t7AvMYPG7nztttVARUgQSqgc2+/h8N1pzlcdzpQSbScVcvDdaeZe/s9AFzzr9OC1jH9uq8Gmt6dv4NpJn+v7h02r1/HqGF9GZF2JquWF/HCc88y9pIBjEg7k4VzZ3Y6/u1P/4bqQweZt6iIw3Wn2ff6e4yfMClomYGDhjD6sit4cc8u7r59VptXwNuptZEAREQktn1pVFag4nf73Dt489C7rLpvddAytgp62+z51H9Qz71F94dd17pfP8Jbbx/nicd+E1RtvOjC4VwzaQoAFwwaTHJyMmMvu4JNWzbwx9eCW9P6nWuqmDaGgu/P4ZL0kYGKqJ1/zaQpXJJ+Kd/4+pRA/KqAilNCJKDWicYG5n5vKic/+pAp13+bKdd/m5MffciyxQuCkrCJk77JV3ImAHDhxSPInXIDD6xe70kTPMAP5ixg+sxZrFpexIi0Mxl7yYCwF1QBnHHGmRQuWxVIUm3S6o7HTsXL1wT1ge33v/pz3vlpHH/zCACNDQ1UHzrIBYOHef32iYiIy/hxV5I2oOXK8f2vvMTax9YEkswFty7ioUceDAzB9MOZsxhxsbkuYM+L5UFN7iseXs7zFbsYnX0pQ0cODAxtZPuMAoF1XZkzgbxp+aSk9AmKxzbpg0l8d1c8z8ybvsu8O+cydORA5t05l1X3rSZ/+ndpbm4Oir/xQzMcU7juAO7hojZt2UD6ZReGLJd+2YWtVkYlfiRMArqt9HHGXjKArMvHBfpO9v3MZ7n3Z79kQNrnGDWsb2B8z0u+kElKn7MBaG46Rfqlo1g4dybrH/05GSNH0S81layx49j2+0ouHJ5Oc9Mp3j5ey4C0z4Vc0NSdIlVA36t7h7nfm8rm9eu4/sYZJCensHtnGS8892zQsEzOimyk6ue5/VLJunwc79W9Q3NzE28dr2X8hElc9HkNwyQiEsuO1L7BPUt+zNLCewNJ5rgv5zAmayz3r7o3ZJzMcV/OCaoeLrh1UVBfzWU/WU5ycnLgKvtfPPwrnq/YxYbNv6bfuf1Y9pPlIVe0W/PunMueF8uZ/f05/LjIXKy04NZFgf6kjY0fhFzBbi24dVFQXO6K7m2z5wc9XrpxW1Dcttor8S0hEtDVDy7ll2seoKziUKCJ3Wnu7fewedtupl/31aCB5wGSU/ow/PPpZIwcxfant1B96CCvHng5aJkjf6oJSfbcbEXRCjfQfVsiVUAHpH2OR5/YzuG602SNHcfRN2oCY44unDszkFi7K6Du6qdlxzUdNawvv1zzAPcsXakhmEREYtjJv57kkUd/zuzvzwkaYxNMwpY2YCDrfv1Ih9e7/5WXWPHwcm770e18ddxV5E3LJ2PEJYFktqm5ibfePk7agIEkJydz2+z5gWbwFQ8vZ+u237B3ZyV50/Kpe+9dvvVv0zm//3lMuDYn4iDzKx5eHlTVdPYldQ48bwevH/Oly1m/7gkaGz/g1jt+FHjMPfC+xJeESEDn3n5PoFoZiR1r052gPrT8p+RmjyR3yg2BxO34m0eC7jzULzWVH85ZGDQGp7X/xYpAn1DnMEk2af1KzsR270drfUCdtj/9G847P419r79HWcUhin58S0ifVPedk5zslfeH6063+bpJsBHDhrJv8+NxP1i49iO2JMp+SM/pe05f7l+ykuuvvSHs486LjZycdyxa8fByxmSNDVwtD6aZftV9qxnzpctJTjbjiE6aOJk/vv4qQ0cOZHT2pTxfsYtxXzaD2T+0diXpl11I2oCBlG7cxvMVu7hiYhZgxgkdOGAgq5avIW9aPh84Rm1xaq0Caquxt86ezwWDBgclqxOuzWHb9qe4arw5r27Y/Guv3xbpgqRbHnzOd9vN472OI+FsK32c/S+Whx2HVHrOkVtu5Kq77un6ijy2a9lS7UcMSZT9eGzTYaZ8f4LXYYhIL/bMY88xZ8XNSQkxDFMs0jBJIiIiIuElRBO8iIiIiMQPJaAiIiIiElVKQEVEREQkqpSAioiIiEhUKQEVERERkahSAioiIiIiUaUEVERERESiSgmoiIiIiESVElARERERiSoloCIiIiISVUpARURERCSqlICKiIiISFQpARURERGRqFICKiIiIiJRpQRURERERKJKCaiIiIiIRJUSUBERERGJKiWgIiIiIhJVZwI89PgLXsch0i1OvFYNy5Z6HUaXLXq+nOVoP2JFouwHQ6fxzGPPeR2FiIhIwvF5HYD2Q/sRwxJlP0QkzqkJXkRERESiSgmoiIiIiESVElARERERiSoloJJofup1AN2k1usAtB8JuR+7vA5AREQkEb0PDPA6iC5KA/4ODPc6EO1Hwu3HLqCv14GIiKgCKonm/wE3ex1EFy0BPgSu8zoQ7UdgP04kyH78C3DS60BEREQSzWjgE+B6rwPphFSgBHgBuFz74blE3I9Pex2MiIhIopoMHAaeBmYCn8d/04UY8ilMk2g2cAuwFdPMuwI4S/uh/ejB/RAR8VyS1wGI9JAzMEnC14FM4AJM37e2PvP/BP4BnMI0H/8FOA78CXgF2A2828VtfAL8Daj3r/s14EVgB/Ce9kP7EYX9EBHxlBJQ6U3Oxpyg2+sMzMl/BDAWUwEbABQBHwAPAa8DpcAfgKPA6TbWeQ4mUWjSfmg/Ymw/REREJEZdDTQSv/0BnftxQvsRMxJlP0RERKSH+ID5Xgeh/dB+iIiISO/hI/7HGtV+xJ5E2Q8RERHpZimYRCHeaT9iS6Lsh4iIiPSQREkUtB+xJVH2Q0SkTboTkoiIiIhElRJQkY772OsAtB/aDxERERERERERERERERERERERERERERERERERERERERERERGR6JjudQAiIiIi0jsMB54EKoFcr4MRERERkcS2EPgHUOh1ICIiIiKS2K4E9gDbgJFeByMiIiIiiasP8DPgXeC7XgcjIiIiIoktDzgGrAY+63UwUXKVf0pUPwFu8TqIbtqP7f59Ge51MCIiItJ1I4BSYB9wtdfBRFmRf0pUo4DnMReRne91MF3QB7gReBRTna8E/jeQ43VgIiIi0nH/AfwT+LHXgXikiMROQK2lmMTtRq8D6SbZmAS0EngHk5jeCJztdWAiIiIS2UTgRWArkO51MB4qonckoACTgMPAKq8D6WbDMU3z2wEf8AxqqhcREYkpfYGfA8eBfK+DiQFF9J4EFCAF+CXwConZfH024Zvqs70OTEREpLf6Dqa58iHUVGkV0bsSUOs7wEckfteLHNRULyIi4olLgaeAP5DYV3x3RhG9MwEFuBD4Habpujc0Vw8HbkVN9SIiIj3ubuA0cIfXgcSoInpvAmrdCfwV+J7XgUSRbap/jJam+qWoqV5ERKRLJgEvA78BLvY6mBhWhBJQgK9gPi+P0Tubp21T/SsEN9X38TowERGReNAPWAvUAjd5HUwcKEIJqNNK4M/AN7wOxEPOpvp/oqZ6ERGRVn0feA94EDjL62DiRBFKQN1uAN4GlnkdSAxQU72IiEgEX8RcTPICMN7rYOJMEUpAw+kPPAGUA6O9DiaGhGuqn4qa6kVEpJf5CfAxcLvXgcSpIpSAtmYO8Alwm9eBxKCLUVO9iIj0MtcABzBVqmFeBxPHilAC2pYvArswF7SleR1MjDob+BYtTfUvo6Z6ERFJIP2BX2AuFPmW18EkgCKUgLZXMaaP8TSvA4kDOZg+tB1tqn8NKPM6eBEREadZQANwP3Cm18EkiCKUgHbE14Fq4GGvA4kjtqn+/9J2U/0vgFOYG0eIiIh46kuYk9cuzHiN0n2KUALaUWcB64AqdNFbR51D6031szF9uj8GdnodrIiI9F7FwN/QRSA9pQgloJ2VD5zA3G3L7QFgudcBxoHxBDfV/xZTAfUBzZjb5/bGGwOIiIhHvgn8EdgAXOB1MAmsCCWgXTEMkzTtAD7vmP9n4AOvg4szFwP7aElAbRJ6ADjf6+BERCSxpQG/AmowA4JLzypCCWh3uAOTOP3A//cJ/98LvA4sjvwM+IiW5NNOfwOea8fz8xzPOQCkux4vdDy+A0jtYryp/vX46Jmr/W28hY55KZg7vdn9WOufJxK3dEGHxII5mOa4Rwg9eYjEsvsxN0J4GJiISQo+jUnu12KSKInsd8DVwD+A05jq8WvAHkxLyB87uL5MYAzmiyyYZDHeh4RKwdwqtsAxz/4+H2jyOkCRzlACKl4aA9wLJGGuMn7J64BEOmEvZoim3zvm2ST0Dq+Di3FLMFXOCkyy+dduWOdFjt8zgFyvd7KLsjAJZxmm2tsfeBK4AhhCS7ItElc+5XUA0mstw5ywn8JUQJR8SjwaAKzB9P0ciEk88f9cgPoxt+VFYAUmie9q8vksZoSCbFqa2Yf5fz4Z4TnO5nl303Y6pkn/AObCMtvEf3GY9WQTvgtAnmv97mqsu2m9MMy6J/p/VmCGo6sBSmmp9orEJSWgEm3/BrwOfA5TnVjtdUAiXTAaU51qxjSF/t3x2D8wt4yV6DiKSULTMFXCFMzV9lWEH9qpEDPahlMBsNA1L5OWSnYdoReZZQPl/t/n0lKRLAQ2upYtxySlEL5pvThMTNaRMPMuQiROKQGVaLkAWI8Z++9O4LuY8QBF4lkZcAbwBeBmTKLyKFCJ6f85ARjsdZC9yJ9pqQz2wVRA6zB3snKyfUPLMMlqEjDD/9ggQi/wWexfZjLBCehIWr5Ez8BUKcFUQae61p+BSYbz/dsfgmlGB3MHKecyVoo/HrdwyahIXFEfUImGWzF9PVcCM70ORqQHHPVPO1zzz6F7+jVK++yj5UYB72P6fy4G6l3LNWCSSTDJ4u8xiWs4VcCWCI+VOH5udcwf419fZphtg0lK7TIlmC8sENy8LpLQVAGVnnQF5gKDa4GvEr5/k0giU/IZXfWYiucwTAUSwje/O/teVtP1hK8Ac7FQe2RiEtBI2lPdVNO7xD0loNITzgDuA7YDmzFViMourVFEpG0NmGbwXExSWEX4CqS9shxamr9ntGcDLiXAJP/v+YQ23ZdgugIkuaYKoDbCOp3JZRPwdpj5lpriJW4pAZXudiOmopCKadoq6drqREQ6xJmU7QWOhVlmmP+nbf62Fyx11AbMhUUlmITW3kRjPyb5dVZG7ZXydjD8+jDL2L6jTjsdz0+lpf9qlX87InFJfUCluwzF9PP8AjAPU/0UEYk2m/xlYqqH4QZqr/X/LCD4KvTOaMIkogWYKugOgvtylruW34Cp1Da0soxTJS0JrrOaW0L45FokLqgCKt1hPqbqeRgYhZJPEfGO7QcK4ft/gmkCdza5l2BGKyijZYD3jqjAXOyUS8vFTUv885xmAJscf7uXWRzmOU2Y/7HO1qQSdBckEenFsoHdwDOYxFNim3M4lyKC7wU/qENrEhER6QJVQKUzPo25e8l/A/8JTAEOeh2UtKovsAszKsFYx/yx/nm7/MuIiIiIeOZK4ENCbyU4HTPeYQnQz+sgpUPuBU5jBkh/0z/9zT/vXq+DExEREXkV07/oUv/fwzH3U67E9HOS+NMXc8tIn2tqJrGrn877cR8g+F7dEHw/cHuFclek+tcT7t7f3cHGG25cXXv/cuc9zUVEYo6a4CWc+ZhO+M2Y+yovxFxk9CpmuJAyrwOUTjmJuRuV837lf/fPO+l1cFFib9No2SFtEkEK5tjVXXREJOZpGCZxGwwsx3w2TgKP0TKkyWteByddtgyTpFg+/7zexDmgdwaJUdFPx7RQKPkUkbigCqi4rcL0CQTTLDsEc39lJZ+JwVkF7W3Vz2cxX6bsgN7QMiD5kxGe42ye9xHctG2buw9gvrTZJv6Lw6wnm/BdAPJc63dXY523jIzU7J5Ny+0kI+2HiIhIzLoO+IjQPoKngOPAj7wOULpFX+Bj/5TIfT8tm+StxSSKBzBJoE3uDgCzCO0D6k4+3UmgTUCdj+0APk9wH9BswieYkdaf53/cnXxGiiPbEbfdlvqAikhMUwVUnDb4f34E/BVTCW0GPgA+Af7hdYDSLU4C6/1Tb6l+Wn+mpR9oH0wFtA54z7WcTebKgP4E3yt8EKHJ3WL/MpMxx4s1Eljt/30GZsByaLnlonP9GZgKbb5/+0Mwg6JDy/3K7TJOFf7tNnj94oqItJf6gIrT3cBbmJNxnX/SnTYS0797HYBH9mESuPHA+5j+n4sJvsUhmGTO3tEmHfg9kftXVgFbIjxW4vi51TF/jH99mWG2DSYptcvY+5VD8C0eRUTilhJQcfq51wGI9DB7m8ZhmAokhL9dYwqmf2xX7xNuFWBaGCrasWwmJgGN5Eg0XigRkZ6kJngR6U0aMElgLiYprCJ8BTKLluTTNn/PaM8GXEqASf7f8wltui/BdAVIck0VQG2EdV6EiEicUwIqIr2Ns4K4FzgWZplh/p+2+TsF02zfURuAcv96CoAb/PP3Y5LfAkyyCy0XENkLiurDLGP7joqIxDUloCLS29jkD+BtwvdzrvX/LMCMAnGKzjfHN9FygZ+9wMj25QSToPr8P/Ev2xBhGTvckohIXFMCKiK9je0HCuH7f4JpAnc2uZdgbtJQhrkyfUgHt1mBudgpl5aLm5b45znNADY5/nYvszjMc0RERERERESkNUleB9Ab+Hw+n9cxJIKkpKS4+bzqPe8e8fSei4hI+6kJXkRERESiSgloFDQ0NDB58mSSkpLCTpMnT6ahoSFouYqK9gwX2LkY7Lo3bdpEUlISs2fPpqmpe8abr6mpYfTo0YwePZqampqIy/XEtmNJe99zCdbez4+IiMQ3JaAiHigrKyMvL09JqIiI9Eq6E1KUlZeXk52dHfHxHTt2RC2WvLw88vLyvH5JEp77PW9oaCAvL4+ysjKqq6tb/TyIiIgkIlVAY0i4ZvIlS5aQlJTEkiVLAs3WkZpw7bJ2aqt5290Mbps/wzUZO7sEtHc71dXVQetrT7cC5z72RFeEWNCnTx+GDRsGQG1tbdBjztfW3QxtXxv3Z2HJkiUhr52dZzU1NTF79uyg19a5jLPp++mnn474vjk/M+vWrWv18+j+PLljAqioqAja3+rqaq/fHhERkcRQX1/vy83N9QG+8vJyXyThlisuLvZhBqAOmQoKCnynTp1qdbni4uKI6964cWPQeqqrq32ZmZlh19NWPHY7ra2jtW23tu6NGzf64u2q8tbec+drZB87deqUr6CgoF2vWbjp29/+dsTXrbV122U6+r6Fm3Jzc3319fU+n8/nKy8vb/MzG2kZwJeZmemrrq6Oq/dcRETaTxXQKMvJyWm1uhhJZmYm1dXV+Hw+Nm7cCMDevXs5duwYDQ0NVFRUkJubS319fdAyb7/9drsv8klPT+fAgQP4fD7q6+vJzc0FIDc3l4yMjA5vp7i4GJ/Px6lTpygoMDeR2bBhQ9h4ampqKC0tDVp3dXU1mZmZbNiwIa77Srrf84yMDKqqqigoKCAry9xhsbKykpKSEgoKCjh16hQ+n4/y8vKwr5n9LDhf1+rq6pB5R46YO04eO3aMvXv3Bq27uLg4aJm23redO0PHay8vLw96n2yXgqamJjZs2BC0jF1XSUkJlZWVQesMF5eIiCQ29QGNE1OnTiU9PR2AMWPGkJnZcje+1NTUQN/Rmpoavva1r1FVVdWp7YBprr377rspKysjMzOTVatWkZqaCtDu7WRmZjJt2jQAUlJSyM/Pp6SkhNraWk6dOhWy/P79+6mqqqKqqor+/fuHPF5fX+/1W9Ct3P1CbTJWUlJCSUlJ0LLu1+yKK65gyJAhpKSkMH78eEpKSsLOs+wXCzBN3jk5ORHjivS+VVRUBH0JcCbP6enpTJ06laqqKnbu3En//v3Zu3cvQNht1dbWkpGREfjilZ+fT0pKCgDTpk2jtLQUERFJbKqARpmtCDmnrl6E4uzfZ6trXbF169ZAArN69epA4tuR7aSlpQUlkv379w9KmjuiqqoqrhNQ+57bajGE9v1sTV1dXdD+Dxo0KJCwtTbPcvYtbi35hPa/b+7tXXTRRe3en3BVV+f20tLSOvtSi4hInFACmgBs8y2ET3Y6oqKighkzzC2wi4uLg5LjjmzHnTTV19e3KzF2Nsd2Z5IeC/Ly8gJNzDNmzAjb9cI2fzunAwcOBL4EdMaOHTsC1WzbjSNSU3d73zd3l4twSaVze86psLAw6EIsp/r6eurq6hARkcSmBDQB2GqabRZtamrihRde6PB6ampqmDt3bmBdCxcu7PR2qqqq2LJlC0BQn8Ds7OxAc76T7Vbg7CNor5BOpEHb58yZE+hb6+zbOXHiRABKS0sDV75312D9Njm03ThsX95w2vu+Od8n23/X7seQIUO44oorgtblHuEhJSWFQYMGhbwOW7Zs6XIFX0REYp8S0ARgK0klJSX06dOHPn36hPQjbA/bD9O5LucQOh3dzuLFi0lKSgpaziZabrYfIbRctGObi/Pz88MmrfEoNTWVwsLCwOu4detWALKysigoKKCqqoqMjAySkpIClWhnH8nOsM3j9v3o378/ZWVlEZd3v2/OfqFO9n1yX1Rl+46G26az7+i0adMCXzrsZ23x4sVev0UiIhIFSkATQHZ2dlBTeEFBAcePHyc3NzdwpXy0t5OZmclTTz0V1H+wrUH4CwsLQ5qGN27cmHCD5WdnZwf28/7776empoaUlBRWrlwZuOq8va9Zezib/sE089sr190XF7nft8zMTJ588smQLgD2inbn3ytXrgwkytnZ2YGr+CMtk56ezpNPPhm0LfdnRkRERDrJJ93C6/cxkd9zOw6oHX8zknDjt/Ykr99HERHpGaqAioiIiEhUKQEVEREREREREREREREREREREREREREREREREREREREREREREREREREREel5/wO1T4tFWQ3QVAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNS0wMS0zMFQwOTowMDowMSswMDowMOKPS7IAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjUtMDEtMzBUMDk6MDA6MDErMDA6MDCT0vMOAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDI1LTAxLTMwVDA5OjAwOjAxKzAwOjAwxMfS0QAAAABJRU5ErkJggg==)
读屏障

判断对象的引用地址条件，做出动作 如对象地址视图是否变化，是否转移，是否强引用等

## **初始标记 Remapped**

```plain
堆内存不足或定时触发,标记GC Roots直接可达的对象，相比G1记录活跃页面的地址。
```


## **并发标记 Marked**

```plain
对比G1GC三色标记，白色，标记线程未访问，黑色访问完，灰色引用对象未访问
遍历对象图，标记所有存活对象。
remapped是上次标记被转移火被访问，本次不活跃
第一次标记是Marked0
下一次标记就修改成Marked1，区分上次标记未转移的Marked0
```


## **再标记**

```plain
STW修正并发标记期间遗漏的引用变更（如线程栈或全局引用的更新）
```


## **并发转移准备**

```plain
选择待回收的Region，计算对象转移的目标地址。


Region跟G1不同不分代
Small Region 2MB 存小于256KB
Medium Region 32MB 存256KB-4MB
Large Region N*2MB 只存1个大对象不会被重新分配
```


## **并发转移**

```plain
全并发移动对象：将存活对象复制到新Region，同时通过读屏障确保应用线程访问旧对象时自动转发到新地址。重新标记为Remapped
重定位：逐步更新所有引用指向新地址。
```


# 分代ZGC

```plain
分代ZGC分为Young区和Old区 Young区沿用G1GCRegion概念

Young区频繁，ZGC页管理相比G1GC在大内存上吞吐量更好，那么对于老对象频率低不更改

对于频繁更新，分区不需要每次回收全部区域，减少整体回收时间增加吞吐量
```










